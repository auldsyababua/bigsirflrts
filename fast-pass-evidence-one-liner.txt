EV_BASE="/root/bigsirflrts/infrastructure/qa-evidence/story-1.1"; TS="$(date -Iseconds 2>/dev/null || date +%Y-%m-%dT%H-%M-%S)"; TS="${TS//:/-}"; EV_DIR="$EV_BASE/run-$TS"; mkdir -p "$EV_DIR"; docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}' | tee "$EV_DIR/docker-ps.txt" >/dev/null; ( cd /root && docker compose -f docker-compose.yml -f docker-compose.override.yml ps | tee "$EV_DIR/docker-compose-ps.txt" >/dev/null || true ); cp -f /root/docker-compose.yml "$EV_DIR"/ 2>/dev/null || true; cp -f /root/docker-compose.override.yml "$EV_DIR"/ 2>/dev/null || true; for p in default database worker all; do code="$(curl -s -o /dev/null -w '%{http_code}' "http://127.0.0.1:8080/health_checks/$p" || true)"; echo "$p: $code" | tee -a "$EV_DIR/health-codes.txt" >/dev/null; curl -s "http://127.0.0.1:8080/health_checks/$p" > "$EV_DIR/health-$p.json" || true; done; docker logs --tail=200 openproject > "$EV_DIR/openproject-logs.txt" 2>&1 || true; docker logs --tail=200 openproject-worker > "$EV_DIR/openproject-worker-logs.txt" 2>&1 || true; printf "Evidence directory: %s\n" "$EV_DIR"
