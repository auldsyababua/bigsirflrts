# MVP Test Scenarios: Story 1.1

## Given-When-Then Format for P0 Tests Only

_For Qodo generation and manual validation_

---

## 1.1-INT-001: Wrangler Deploy Success

**Given** a configured wrangler.toml file with OpenProject settings  
**And** valid Cloudflare API credentials  
**When** I run `wrangler deploy`  
**Then** deployment should complete without errors  
**And** the worker URL should be returned  
**And** deployment logs should show "Published successfully"

```bash
# Qodo: Generate deployment validation test
qodo test --type integration --name "wrangler-deploy"
```

---

## 1.1-E2E-001: Homepage Loads for Executive

**Given** OpenProject is deployed to Cloudflare  
**When** an executive navigates to the application URL  
**Then** the homepage should load within 3 seconds  
**And** the OpenProject logo should be visible  
**And** no error messages should appear

```javascript
// Playwright test - Qodo can enhance this
test('Executive homepage experience', async ({ page }) => {
  await page.goto(process.env.OPENPROJECT_URL);
  await expect(page).toHaveTitle(/OpenProject/);
  await expect(page.locator('.logo')).toBeVisible();
});
```

---

## 1.1-UNIT-001: API Key Format Validation

**Given** the API authentication module  
**When** an API key is provided  
**Then** it should validate format (32+ characters)  
**And** reject malformed keys immediately  
**And** not make database calls for invalid formats

```javascript
// Unit test - Let Qodo generate edge cases
describe('API Key Validation', () => {
  test('validates key format', () => {
    expect(validateApiKey('short')).toBe(false);
    expect(validateApiKey('a'.repeat(32))).toBe(true);
  });
});
```

---

## 1.1-INT-002: Valid API Authentication

**Given** a valid API key stored in Cloudflare secrets  
**When** a request includes this key in headers  
**Then** the request should be authenticated  
**And** user context should be established  
**And** response should include success indicator

```bash
# Simple curl test
curl -H "Authorization: Bearer $API_KEY" \
     https://openproject.example.com/api/v3/users/me \
     | grep '"type":"User"'
```

---

## 1.1-INT-003: Invalid API Key Graceful Rejection

**Given** an invalid or expired API key  
**When** a request includes this key  
**Then** response should return 401 Unauthorized  
**And** error message should be professional  
**And** no stack traces should be exposed  
**And** response time should be < 1 second

```javascript
// Qodo: Generate variations of invalid keys
test('handles invalid API keys gracefully', async () => {
  const response = await fetch('/api/v3/users/me', {
    headers: { Authorization: 'Bearer invalid123' },
  });
  expect(response.status).toBe(401);
  const body = await response.json();
  expect(body.message).toBe('Invalid authentication credentials');
  expect(body.stack).toBeUndefined();
});
```

---

## 1.1-E2E-002: Admin Login Via UI

**Given** an admin account exists  
**And** I am on the login page  
**When** I enter valid admin credentials  
**And** click "Sign In"  
**Then** I should be redirected to the dashboard  
**And** see "Welcome, Admin" message  
**And** have access to administration menu

```javascript
// Critical path for executives
test('C-suite admin login', async ({ page }) => {
  await page.goto('/login');
  await page.fill('#username', 'admin@company.com');
  await page.fill('#password', process.env.ADMIN_PASSWORD);
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('.admin-menu')).toBeVisible();
});
```

---

## 1.1-E2E-003: Create Task in UI

**Given** I am logged in as an admin  
**And** I am viewing the Tasks project  
**When** I click "Create Work Package"  
**And** enter "Q1 Planning Meeting" as title  
**And** click "Save"  
**Then** the task should appear in the list  
**And** have a unique ID assigned  
**And** show creation timestamp

```javascript
// Core functionality test
test('Executive can create task', async ({ page }) => {
  // Qodo: Generate login helper
  await loginAsAdmin(page);

  await page.goto('/projects/tasks');
  await page.click('button:text("Create")');
  await page.fill('input[name="subject"]', 'Q1 Planning Meeting');
  await page.click('button:text("Save")');

  await expect(page.locator('text=Q1 Planning Meeting')).toBeVisible();
});
```

---

## 1.1-UNIT-002: Health Check Returns 200

**Given** the health check endpoint exists  
**When** a GET request is made to /health  
**Then** response status should be 200  
**And** response should include {"status": "healthy"}  
**And** response time should be logged

```javascript
// Minimal health check
test('health endpoint responds', async () => {
  const response = await fetch('/health');
  expect(response.status).toBe(200);
  const data = await response.json();
  expect(data.status).toBe('healthy');
});
```

---

## Qodo Generation Commands

```bash
# Generate all P0 tests quickly
qodo generate \
  --priority P0 \
  --style minimal \
  --framework vitest \
  --output tests/mvp/

# Generate mocks for external dependencies
qodo mock \
  --service cloudflare-d1 \
  --responses success,timeout

# Create test data fixtures
qodo fixtures \
  --users 2 \
  --tasks 5 \
  --simple
```

## Manual Fallback Script

For quick validation without test framework:

```bash
#!/bin/bash
# mvp-smoke-test.sh

echo "üß™ MVP Smoke Test for Story 1.1"

# Test 1: Deployment check
echo -n "Checking deployment... "
curl -s -o /dev/null -w "%{http_code}" $OPENPROJECT_URL | grep -q 200 && echo "‚úÖ" || echo "‚ùå"

# Test 2: API health
echo -n "Checking API health... "
curl -s $OPENPROJECT_URL/health | grep -q "healthy" && echo "‚úÖ" || echo "‚ùå"

# Test 3: Auth works
echo -n "Checking authentication... "
curl -s -H "Authorization: Bearer $API_KEY" \
  $OPENPROJECT_URL/api/v3/users/me | grep -q "User" && echo "‚úÖ" || echo "‚ùå"

echo "MVP smoke test complete!"
```

---

_These 8 P0 scenarios provide sufficient confidence for MVP launch with 5-10
users._
