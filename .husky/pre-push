#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push validation checks..."
echo "This will run unit and integration tests to ensure code quality before pushing."
echo "This may take 30-90 seconds..."
echo ""

# Run unit tests
echo "ğŸ“¦ Running unit tests..."
if ! npm run test:unit; then
    echo ""
    echo "âŒ Unit tests failed!"
    echo "Please fix the failing tests before pushing."
    echo "Run 'npm run test:unit' locally to debug."
    exit 1
fi

echo "âœ… Unit tests passed!"
echo ""

# Run integration tests  
echo "ğŸ”— Running integration tests..."
if ! npm run test:integration; then
    echo ""
    echo "âŒ Integration tests failed!"
    echo "Please fix the failing tests before pushing."
    echo "Run 'npm run test:integration' locally to debug."
    exit 1
fi

echo "âœ… Integration tests passed!"
echo ""

echo "ğŸ‰ All pre-push checks passed!"
echo ""
echo "ğŸ’¡ Reminder: The full CI environment will run 'npm run test:ci-local' on GitHub Actions."
echo "   If you want to test the exact CI environment locally before pushing, run:"
echo "   npm run test:ci-local"
echo ""

exit 0