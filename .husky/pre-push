#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "🚀 Running pre-push validation checks..."
echo "This will run unit and integration tests to ensure code quality before pushing."
echo "This may take 30-90 seconds..."
echo ""

# Run unit tests
echo "📦 Running unit tests..."
if ! npm run test:unit; then
    echo ""
    echo "❌ Unit tests failed!"
    echo "Please fix the failing tests before pushing."
    echo "Run 'npm run test:unit' locally to debug."
    exit 1
fi

echo "✅ Unit tests passed!"
echo ""

# Run integration tests  
echo "🔗 Running integration tests..."
if ! npm run test:integration; then
    echo ""
    echo "❌ Integration tests failed!"
    echo "Please fix the failing tests before pushing."
    echo "Run 'npm run test:integration' locally to debug."
    exit 1
fi

echo "✅ Integration tests passed!"
echo ""

echo "🎉 All pre-push checks passed!"
echo ""
echo "💡 Reminder: The full CI environment will run 'npm run test:ci-local' on GitHub Actions."
echo "   If you want to test the exact CI environment locally before pushing, run:"
echo "   npm run test:ci-local"
echo ""

exit 0